{% extends "base.html" %}
{% block title %}Buchung - {{ hotel.name }}{% endblock %}
{% block content %}
<style>
    /* Video Hintergrund */
    .video-bg-container {
        position: fixed;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        overflow: hidden;
        z-index: -1;
    }
    
    .video-bg-container video {
        position: absolute;
        top: 50%;
        left: 50%;
        min-width: 100%;
        min-height: 100%;
        width: auto;
        height: auto;
        transform: translate(-50%, -50%);
        object-fit: cover;
    }
    
    .video-bg-overlay {
        position: absolute;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        background: rgba(0, 0, 0, 0.4);
    }
    
    /* Content √ºber dem Video */
    .content-wrapper {
        position: relative;
        z-index: 1;
        min-height: 100vh;
        padding: 2rem 0;
    }
    
    /* GROSSE SEMI-TRANSPARENTE BOX */
    .main-container-box {
        background: rgba(255, 255, 255, 0.92);
        border-radius: 20px;
        padding: 2.5rem;
        box-shadow: 0 20px 60px rgba(0, 0, 0, 0.4);
        backdrop-filter: blur(10px);
        margin: 0 auto;
        max-width: 1400px;
    }
    
    /* Titel innerhalb der Box */
    .main-container-box h1 {
        color: #333;
        text-shadow: none;
        margin-bottom: 2rem;
        font-weight: 700;
        border-bottom: 3px solid #007bff;
        padding-bottom: 1rem;
    }
    
    /* Cards innerhalb der Box */
    .card {
        background: rgba(255, 255, 255, 0.98);
        border: 1px solid rgba(0, 0, 0, 0.1);
        box-shadow: 0 4px 12px rgba(0, 0, 0, 0.08);
        margin-bottom: 1.5rem;
    }
    
    .card-header {
        background: rgba(0, 123, 255, 0.1);
        border-bottom: 2px solid #23387E;
    }
    
    .alert {
        background: rgba(255, 255, 255, 0.95);
        border-left: 4px solid #17a2b8;
    }
    
    /* Fortschrittsleiste */
    .progress {
        background-color: rgba(200, 200, 200, 0.4);
        border-radius: 10px;
        box-shadow: 0 2px 5px rgba(0, 0, 0, 0.2);
        height: 25px;
        flex-grow: 1;
        margin: 0;
    }

    .progress-bar {
        display: flex;
        align-items: center;
        justify-content: center;
        font-weight: bold;
        color: white;
        text-shadow: 1px 1px 2px rgba(0, 0, 0, 0.3);
        transition: width 0.6s ease;
        font-size: 14px;
        height: 100%;  
    }

    /* Datumsfelder f√ºr Litepicker */
    .form-control[type="text"] {
        padding: 10px 12px;
        font-size: 16px;
        cursor: pointer;
        background-color: white;
    }
    
    .form-group {
        margin-bottom: 1.5rem;
    }
    
    .form-group label {
        font-weight: 500;
        margin-bottom: 8px;
        color: #333;
        display: block;
    }
    
    .progress-wrapper {
        display: flex;
        align-items: center;
        gap: 15px;
        margin-bottom: 2rem;
    }

    .progress-text {
        color: #333;
        font-weight: 500;
        white-space: nowrap;
        min-width: 120px;
    }

    /* Litepicker Styling */
    .litepicker {
        font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        z-index: 1000;
    }

    .litepicker .container__days .day-item.is-start-date,
    .litepicker .container__days .day-item.is-end-date {
        background-color: #2874a7 !important;
        color: white !important;
    }

    .litepicker .container__days .day-item.is-in-range {
        background-color: rgba(40, 167, 69, 0.2) !important;
    }

    /* Date Range Container */
    .date-range-container {
        display: flex;
        gap: 10px;
        align-items: center;
    }

    .date-range-container input {
        flex: 1;
    }

    .date-range-separator {
        color: #999;
        font-weight: bold;
        padding: 0 5px;
    }
    /*G√§ste Auswahl*/
    .guests-container {
    display: flex;
    gap: 30px;
    align-items: flex-start;
}

.guest-section {
    flex: 1;
}

.guest-section label {
    font-weight: 500;
    margin-bottom: 8px;
    color: #333;
    display: block;
}

.guest-input-group {
    display: flex;
    align-items: center;
    gap: 10px;
}

.guest-btn {
    width: 36px;
    height: 36px;
    border: 1px solid #007bff;
    background: white;
    color: #007bff;
    border-radius: 4px;
    cursor: pointer;
    font-weight: bold;
    font-size: 18px;
    transition: all 0.2s ease;
    display: flex;
    align-items: center;
    justify-content: center;
    padding: 0;
}

.guest-btn:hover {
    background: #007bff;
    color: white;
}

.guest-btn:disabled {
    opacity: 0.5;
    cursor: not-allowed;
}

.guest-count {
    min-width: 50px;
    text-align: center;
    font-weight: 600;
    color: #333;
    font-size: 16px;
}

/* Zimmer Grid 2x2 */
.rooms-container {
    display: grid;
    grid-template-columns: 1fr 1fr;
    gap: 20px;
    margin-top: 2rem;
    margin-bottom: 2rem;
}

.room-card {
    border: 2px solid #ddd;
    border-radius: 10px;
    padding: 15px;
    cursor: pointer;
    transition: all 0.3s ease;
    background: white;
    text-align: center;
}

.room-card:hover {
    border-color: #007bff;
    box-shadow: 0 4px 12px rgba(0, 123, 255, 0.2);
    transform: translateY(-2px);
}

.room-card.selected {
    border-color: #007bff;
    background: rgba(0, 123, 255, 0.05);
    box-shadow: 0 4px 12px rgba(0, 123, 255, 0.3);
}

.room-card h6 {
    margin: 0 0 10px 0;
    color: #333;
    font-weight: 600;
}

.room-price {
    font-size: 18px;
    font-weight: bold;
    color: #007bff;
    margin: 10px 0;
}

.room-info {
    font-size: 12px;
    color: #666;
    margin: 8px 0;
}

.room-input {
    display: none;
}

.btn-hotel-website {
    display: inline-block;
    padding: 6px 15px;
    background: linear-gradient(135deg, #007bff, #0056b3);
    color: white;
    text-decoration: none;
    border-radius: 25px;
    font-weight: 600;
    font-size: 0.85rem;
    transition: all 0.3s ease;
   /* box-shadow: 0 4px 15px rgba(0, 123, 255, 0.3); */
    border: none;
    cursor: pointer;
}

.btn-hotel-website:hover {
    background: linear-gradient(135deg, #0056b3, #003d82);
    transform: translateY(-2px);
    box-shadow: 0 6px 20px rgba(0, 123, 255, 0.5);
    color: white;
}

.btn-hotel-website:active {
    transform: translateY(0);
}


</style>

<!-- Litepicker CSS -->
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/litepicker/dist/css/litepicker.css">

<!-- Video Hintergrund -->
<div class="video-bg-container">
    <video autoplay muted loop playsinline>
        <source src="{{ url_for('static', filename='primVid.mp4') }}" type="video/mp4">
    </video>
    <div class="video-bg-overlay"></div>
</div>

<!-- Content √ºber dem Video -->
<div class="content-wrapper">
    <div class="container">
      <!--Main Box-->
      <div class="main-container-box">
        <h1>Buchung f√ºr {{ hotel.name }}</h1>
        
        <!--Fortschrittsleiste-->
        <div class="progress-wrapper">
          <span class="progress-text">Schritt 1 von 3</span>
          <div class="progress flex-grow-1"> 
            <div class="progress-bar bg-success" role="progressbar" style="width: 33.33%"></div>  
          </div>
        </div>
        
        <div class="row">
          <!--Hauptformular -->
          <div class="col-md-8">
            <!-- Buchungsformular -->
            <div class="card">
              <div class="card-header">
                <h5 class="mb-0"><strong>Schritt 1: Reisedaten w√§hlen</strong></h5>
              </div>
              <div class="card-body">
                <form method="POST" action="{{ url_for('views.booking_step1', hotel_id=hotel.id) }}">
                  
                  <!--Anreise und Abreise Datum Auswahl mit Litepicker-->
                  <div class="form-group">
                    <h6 for="checkin">Reisezeitraum</h6>
                    <div class="date-range-container">
                      <input type="text" 
                             id="checkin" 
                             name="checkin" 
                             class="form-control" 
                             required
                             readonly
                             placeholder="Anreisedatum"
                             value="{{ request.form.checkin }}">
                      <span class="date-range-separator">‚Äî</span>
                      <input type="text" 
                             id="checkout" 
                             name="checkout" 
                             class="form-control" 
                             required
                             readonly
                             placeholder="Abreisedatum"
                             value="{{ request.form.checkout }}">
                    </div>
                    <small class="text-muted">Klicken Sie auf das Anreisedatum um den Zeitraum zu w√§hlen</small>
                  </div>
<hr>
                  <!--G√§ste Anzahl Auswahl-->
                    <div class="form-group">
                        <h5><strong>Anzahl G√§ste</strong></h5>
                        <div class="guests-container">
                            <!-- Erwachsene -->
                            <div class="guest-section">
                                <label>Erwachsene</label>
                                <div class="guest-input-group">
                                    <button type="button" class="guest-btn" onclick="updateGuest('num_adults', -1)">‚àí</button>
                                    <span class="guest-count" id="adults-count">2</span>
                                    <button type="button" class="guest-btn" onclick="updateGuest('num_adults', 1)">+</button>
                                    <input type="hidden" id="num_adults" name="num_adults" value="2">
                                </div>
                            </div>

                            <!-- Kinder -->
                            <div class="guest-section">
                                <label>Kinder</label>
                                <div class="guest-input-group">
                                    <button type="button" class="guest-btn" onclick="updateGuest('num_children', -1)">‚àí</button>
                                    <span class="guest-count" id="children-count">0</span>
                                    <button type="button" class="guest-btn" onclick="updateGuest('num_children', 1)">+</button>
                                    <input type="hidden" id="num_children" name="num_children" value="0">
                                </div>
                            </div>
                        </div>
                    </div>
<hr>
                    <!--Zimmerauswahl-->
                      <div class="form-group">
                          <h5><strong>Zimmertyp w√§hlen</strong></h5>
                          <div class="rooms-container">
                              <!-- Zimmer 1 -->
                              <label class="room-card" onclick="selectRoom(this, 'standard', 120)">
                                  <input type="radio" name="room_type" value="standard" class="room-input" required>
                                  <h6>Standard Zimmer</h6>
                                  <div class="room-price">{{hotel.price_per_night}}‚Ç¨ p.P</div>
                                  <div class="room-info">
                                      <div>üë• bis 2 Personen</div>
                                      <div>üì∫ TV, WLAN</div>
                                  </div>
                              </label>

                              <!-- Zimmer 2 -->
                              <label class="room-card" onclick="selectRoom(this, 'deluxe', 180)">
                                  <input type="radio" name="room_type" value="deluxe" class="room-input">
                                  <h6>Deluxe Zimmer</h6>
                                  <div class="room-price">{{hotel.price_per_night_u1}}‚Ç¨ p.P</div>
                                  <div class="room-info">
                                      <div>üë• bis 3 Personen</div>
                                      <div>üõÅ Badewanne, Minibar</div>
                                  </div>
                              </label>

                              <!-- Zimmer 3 -->
                              <label class="room-card" onclick="selectRoom(this, 'family', 250)">
                                  <input type="radio" name="room_type" value="family" class="room-input">
                                  <h6>Family Suite</h6>
                                  <div class="room-price">{{hotel.price_per_night_u2}}‚Ç¨ p.P</div>
                                  <div class="room-info">
                                      <div>üë• bis 4 Personen</div>
                                      <div>üõèÔ∏è 2 Schlafzimmer</div>
                                  </div>
                              </label>

                              <!-- Zimmer 4 -->
                              <label class="room-card" onclick="selectRoom(this, 'premium', 350)">
                                  <input type="radio" name="room_type" value="premium" class="room-input">
                                  <h6>Premium Suite</h6>
                                  <div class="room-price">{{hotel.price_per_night_u3}}‚Ç¨ p.P</div>
                                  <div class="room-info">
                                      <div>üë• bis 5 Personen</div>
                                      <div>üåÜ Balkon, Whirlpool</div>
                                  </div>
                              </label>
                          </div>
                      </div>
 <hr>
                  <!--Navigationsbuttons-->
                  <div class="d-flex justify-content-between">
                    <a href="{{ url_for('views.booking_detail', hotel_id=hotel.id) }}" class="btn btn-secondary">
                      ¬´ Zur√ºck zur √úbersicht
                    </a>
                    <button type="submit" class="btn btn-success">
                      Weiter zu Schritt 2 ¬ª
                    </button>
                  </div>
                  <input type="hidden" id="total_price_input" name="total_price" value="0">
                </form>
              </div>
            </div>
          </div>
          
          <!-- RECHTE SEITE: Buchungs√ºbersicht -->
          <div class="col-md-4">
            <div class="card">
              <div class="card-header">
                <h6 class="mb-0">Buchungs√ºbersicht</h6>
              </div>
              <div class="card-body">
                <p><strong>Hotel:</strong> {{ hotel.name }}</p>
                <p><strong>Ort:</strong> {{ hotel.city }}</p>
                <p><strong>Adresse:</strong> {{hotel.hotel_street}}</p>
                <p><strong>Preis:</strong> <span id="total_price">0,00‚Ç¨</span></p>
                <!--hr-->
              </div>
            </div>
            <!-- Zus√§tzliche Info-Box -->
            <div class="card">
               <div class="card-header">
                <h6 class="mb-0">Ihre Vorteile</h6>
                </div>
              <div class="card-body">
               
                <li>‚úÖ Kostenlose Stornierung bis 24h vor Anreise</li>
                <li>‚úÖ Sichere Zahlung nach PCI DSS </li>
                <li>‚úÖ Sofortige Best√§tigung der Buchung</li>
                </ul>
              </div>
            </div>
            <div class="card mt-3">
                            <div class="card-header">
                                <h6 class="mb-0">Sie haben Fragen?</h6>
                            </div>
                            <div class="card-body">
                              <p> Bei bestehenden Fragen zu unseren Angebotenen Services, z√∂gen Sie nicht und kontaktieren Sie unser Support-Team!</p>
                              <p>‚úâÔ∏è: {{hotel.hotel_email}}</p>
                              <p>‚òéÔ∏è: {{hotel.hotel_phone}}</p>
                              <p>Hier finden Sie unsere Webseite:
                             </p>
                              <a href={{hotel.hotel_website}} class="btn-hotel-website">
                                   {{hotel.name}} Webseite
                              </a> 
                          </div>
                    </div>
          </div>
        </div>
      </div>
    </div>
</div>

<!-- Date Range Picker Script -->
<!-- Date Range Picker Script -->
<script src="https://cdn.jsdelivr.net/npm/litepicker/dist/litepicker.js"></script>
<script>
  const roomPrices = {
    'standard': parseFloat('{{ hotel.price_per_night }}'),
    'deluxe': parseFloat('{{ hotel.price_per_night_u1 }}'),
    'family': parseFloat('{{ hotel.price_per_night_u2 }}'),
    'premium': parseFloat('{{ hotel.price_per_night_u3 }}')
  };

  function calculatePrice() {
    const selectedRoom = document.querySelector('input[name="room_type"]:checked');
    const numAdults = parseInt(document.getElementById('num_adults').value) || 0;
    const numChildren = parseInt(document.getElementById('num_children').value) || 0;
    const checkinInput = document.getElementById('checkin').value;
    const checkoutInput = document.getElementById('checkout').value;

    if (!selectedRoom || !checkinInput || !checkoutInput) {
      document.getElementById('total_price').textContent = '0,00‚Ç¨';
      return;
    }

    const checkin = new Date(checkinInput.split('.').reverse().join('-'));
    const checkout = new Date(checkoutInput.split('.').reverse().join('-'));
    const nights = Math.ceil((checkout - checkin) / (1000 * 60 * 60 * 24));

    if (nights <= 0) {
      document.getElementById('total_price').textContent = '0,00‚Ç¨';
      return;
    }

    const pricePerPerson = roomPrices[selectedRoom.value] || 0;
    const totalGuests = numAdults + numChildren;
    const pricePerAdult = pricePerPerson * numAdults;
    const pricePerChild = (pricePerPerson * 0.5) * numChildren; // Kinder zahlen 50%
    const totalPrice = (nights * (pricePerAdult + pricePerChild));
    document.getElementById('total_price').textContent = totalPrice.toFixed(2) + '‚Ç¨';
    document.getElementById('total_price_input').value = totalPrice.toFixed(2);  // ‚Üê NEU!
    
    console.log(`üí∞ Preis berechnet: ${totalPrice.toFixed(2)}‚Ç¨`);
  }

  function updateGuest(inputId, change) {
    const input = document.getElementById(inputId);
    let value = parseInt(input.value) + change;
    value = inputId === 'num_adults' ? Math.max(1, Math.min(8, value)) : Math.max(0, Math.min(6, value));
    input.value = value;
    document.getElementById(inputId.replace('num_', '') + '-count').textContent = value;
    calculatePrice();
  }

  function selectRoom(element, roomType, price) {
    document.querySelectorAll('.room-card').forEach(card => card.classList.remove('selected'));
    element.classList.add('selected');
    element.querySelector('input[type="radio"]').checked = true;
    calculatePrice();
  }

  document.addEventListener('DOMContentLoaded', function() {
    const picker = new Litepicker({
      element: document.getElementById('checkin'),
      elementEnd: document.getElementById('checkout'),
      singleMode: false,
      numberOfMonths: 2,
      numberOfColumns: 2,
      minDate: new Date(),
      format: 'DD.MM.YYYY',
      lang: 'de-DE',
      tooltipText: {
        one: 'Nacht',
        other: 'N√§chte'
      },
      tooltipNumber: (totalDays) => {
        return totalDays - 1;
      },
      buttonText: {
        apply: '√úbernehmen',
        cancel: 'Abbrechen',
        previousMonth: '‚Üê Vorheriger Monat',
        nextMonth: 'N√§chster Monat ‚Üí',
        reset: 'Zur√ºcksetzen'
      },
      dropdowns: {
        minYear: new Date().getFullYear(),
        maxYear: new Date().getFullYear() + 4,
        months: true,
        years: true
      },
      setup: (picker) => {
        picker.on('selected', (date1, date2) => {
          if (date1 && date2 && date1.getTime() === date2.getTime()) {
            alert('Abreise muss nach der Anreise sein!');
            picker.clearSelection();
          } else {
            calculatePrice();
          }
        });
      }
    });
  });
</script>

{% endblock %}
