{% extends "base.html" %}
{% block title %}Buchung - {{ hotel.name }}{% endblock %}
{% block content %}
<style>
    /* Video Hintergrund */
    .video-bg-container {
        position: fixed;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        overflow: hidden;
        z-index: -1;
    }
    
    .video-bg-container video {
        position: absolute;
        top: 50%;
        left: 50%;
        min-width: 100%;
        min-height: 100%;
        width: auto;
        height: auto;
        transform: translate(-50%, -50%);
        object-fit: cover;
    }
    
    .video-bg-overlay {
        position: absolute;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        background: rgba(0, 0, 0, 0.4);
    }
    
    /* Content über dem Video */
    .content-wrapper {
        position: relative;
        z-index: 1;
        min-height: 100vh;
        padding: 2rem 0;
    }
    
    /* GROSSE SEMI-TRANSPARENTE BOX */
    .main-container-box {
        background: rgba(255, 255, 255, 0.92);
        border-radius: 20px;
        padding: 2.5rem;
        box-shadow: 0 20px 60px rgba(0, 0, 0, 0.4);
        backdrop-filter: blur(10px);
        margin: 0 auto;
        max-width: 1400px;
    }
    
    /* Titel innerhalb der Box */
    .main-container-box h1 {
        color: #333;
        text-shadow: none;
        margin-bottom: 2rem;
        font-weight: 700;
        border-bottom: 3px solid #007bff;
        padding-bottom: 1rem;
    }
    
    /* Cards innerhalb der Box */
    .card {
        background: rgba(255, 255, 255, 0.98);
        border: 1px solid rgba(0, 0, 0, 0.1);
        box-shadow: 0 4px 12px rgba(0, 0, 0, 0.08);
        margin-bottom: 1.5rem;
    }
    
    .card-header {
        background: rgba(0, 123, 255, 0.1);
        border-bottom: 2px solid #23387E;
    }
    
    .alert {
        background: rgba(255, 255, 255, 0.95);
        border-left: 4px solid #17a2b8;
    }
    
    /* Fortschrittsleiste */
    .progress {
        background-color: rgba(200, 200, 200, 0.4);
        border-radius: 10px;
        box-shadow: 0 2px 5px rgba(0, 0, 0, 0.2);
        height: 25px;
        flex-grow: 1;
        margin: 0;
    }

    .progress-bar {
        display: flex;
        align-items: center;
        justify-content: center;
        font-weight: bold;
        color: white;
        text-shadow: 1px 1px 2px rgba(0, 0, 0, 0.3);
        transition: width 0.6s ease;
        font-size: 14px;
        height: 100%;  
    }

    /* Datumsfelder für Litepicker */
    .form-control[type="text"] {
        padding: 10px 12px;
        font-size: 16px;
        cursor: pointer;
        background-color: white;
    }
    
    .form-group {
        margin-bottom: 1.5rem;
    }
    
    .form-group label {
        font-weight: 500;
        margin-bottom: 8px;
        color: #333;
        display: block;
    }
    
    .progress-wrapper {
        display: flex;
        align-items: center;
        gap: 15px;
        margin-bottom: 2rem;
    }

    .progress-text {
        color: #333;
        font-weight: 500;
        white-space: nowrap;
        min-width: 120px;
    }

    /* Litepicker Styling */
    .litepicker {
        font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        z-index: 1000;
    }

    .litepicker .container__days .day-item.is-start-date,
    .litepicker .container__days .day-item.is-end-date {
        background-color: #2874a7 !important;
        color: white !important;
    }

    .litepicker .container__days .day-item.is-in-range {
        background-color: rgba(40, 167, 69, 0.2) !important;
    }

    /* Date Range Container */
    .date-range-container {
        display: flex;
        gap: 10px;
        align-items: center;
    }

    .date-range-container input {
        flex: 1;
    }

    .date-range-separator {
        color: #999;
        font-weight: bold;
        padding: 0 5px;
    }
    .guest-input-group {
    display: flex;
    align-items: center;
    gap: 10px;
}

.guest-btn {
    width: 36px;
    height: 36px;
    border: 1px solid #007bff;
    background: white;
    color: #007bff;
    border-radius: 4px;
    cursor: pointer;
    font-weight: bold;
    font-size: 18px;
    transition: all 0.2s ease;
    display: flex;
    align-items: center;
    justify-content: center;
    padding: 0;
}

.guest-btn:hover {
    background: #007bff;
    color: white;
}

.guest-btn:disabled {
    opacity: 0.5;
    cursor: not-allowed;
}

.guest-count {
    min-width: 50px;
    text-align: center;
    font-weight: 600;
    color: #333;
    font-size: 16px;
}

</style>

<!-- Litepicker CSS -->
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/litepicker/dist/css/litepicker.css">

<!-- Video Hintergrund -->
<div class="video-bg-container">
    <video autoplay muted loop playsinline>
        <source src="{{ url_for('static', filename='primVid.mp4') }}" type="video/mp4">
    </video>
    <div class="video-bg-overlay"></div>
</div>

<!-- Content über dem Video -->
<div class="content-wrapper">
    <div class="container">
      <!--Main Box-->
      <div class="main-container-box">
        <h1>Buchung für {{ hotel.name }}</h1>
        
        <!--Fortschrittsleiste-->
        <div class="progress-wrapper">
          <span class="progress-text">Schritt 1 von 3</span>
          <div class="progress flex-grow-1"> 
            <div class="progress-bar bg-success" role="progressbar" style="width: 33.33%"></div>  
          </div>
        </div>
        
        <div class="row">
          <!--Hauptformular -->
          <div class="col-md-8">
            <!--Hotel Info-->
            <div class="alert alert-info">
              <h6 class="mb-2">{{ hotel.name }}</h6>
              <p class="mb-0">{{ hotel.city }} - <i class="fas fa-euro-sign"></i> €{{ hotel.price_per_night }}/Nacht</p>
            </div>
            
            <!-- Buchungsformular -->
            <div class="card">
              <div class="card-header">
                <h5 class="mb-0"><i class="fas fa-calendar-alt"></i> Schritt 1: Reisedaten wählen</h5>
              </div>
              <div class="card-body">
                <form method="POST" action="{{ url_for('views.booking_step1', hotel_id=hotel.id) }}">
                  
                  <!--Anreise und Abreise Datum Auswahl mit Litepicker-->
                  <div class="form-group">
                    <h6 for="checkin">Reisezeitraum</h6>
                    <div class="date-range-container">
                      <input type="text" 
                             id="checkin" 
                             name="checkin" 
                             class="form-control" 
                             required
                             readonly
                             placeholder="Anreisedatum"
                             value="{{ request.form.checkin }}">
                      <span class="date-range-separator">—</span>
                      <input type="text" 
                             id="checkout" 
                             name="checkout" 
                             class="form-control" 
                             required
                             readonly
                             placeholder="Abreisedatum"
                             value="{{ request.form.checkout }}">
                    </div>
                    <small class="text-muted">Klicken Sie auf das Anreisedatum um den Zeitraum zu wählen</small>
                  </div>

                  <!--Gäste Anzahl Auswahl-->
                  <!-- Erwachsene -->
                  <div class="form-group">
                    <h6>Anzahl Gäste</h6>
                      <label>Erwachsene</label>
                      <div class="guest-input-group">
                          <button type="button" class="guest-btn" onclick="updateGuest('num_adults', -1)">−</button>
                          <span class="guest-count" id="adults-count">2</span>
                          <button type="button" class="guest-btn" onclick="updateGuest('num_adults', 1)">+</button>
                          <input type="hidden" id="num_adults" name="num_adults" value="2">
                      </div>
                  </div>

                  <!-- Kinder -->
                  <div class="form-group">
                      <label>Kinder</label>
                      <div class="guest-input-group">
                          <button type="button" class="guest-btn" onclick="updateGuest('num_children', -1)">−</button>
                          <span class="guest-count" id="children-count">0</span>
                          <button type="button" class="guest-btn" onclick="updateGuest('num_children', 1)">+</button>
                          <input type="hidden" id="num_children" name="num_children" value="0">
                      </div>
                  </div>

                  
                  <hr>
                  <!--Navigationsbuttons-->
                  <div class="d-flex justify-content-between">
                    <a href="{{ url_for('views.booking_detail', hotel_id=hotel.id) }}" class="btn btn-secondary">
                      « Zurück zur Übersicht
                    </a>
                    <button type="submit" class="btn btn-success">
                      Weiter zu Schritt 2 »
                    </button>
                  </div>
                </form>
              </div>
            </div>
          </div>
          
          <!-- RECHTE SEITE: Buchungsübersicht -->
          <div class="col-md-4">
            <div class="card">
              <div class="card-header">
                <h6 class="mb-0">Buchungsübersicht</h6>
              </div>
              <div class="card-body">
                <p><strong>Hotel:</strong> {{ hotel.name }}</p>
                <p><strong>Ort:</strong> {{ hotel.city }}</p>
                <p><strong>Preis/Nacht:</strong> €{{ hotel.price_per_night }}</p>
                <hr>
                <div class="alert alert-warning mb-0">
                  <small>Der Gesamtpreis wird im nächsten Schritt berechnet</small>
                </div>
              </div>
            </div>
            
            <!-- Zusätzliche Info-Box -->
            <div class="card">
              <div class="card-body">
                <h6>Ihre Vorteile</h6>
                <ul class="small mb-0">
                <li>✅ Kostenlose Stornierung bis 24h vor Anreise</li>
                <li>✅ Sichere Zahlung nach PCI DSS </li>
                <li>✅ Sofortige Bestätigung der Buchung</li>
                </ul>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
</div>

<!-- Date Range Picker Script -->
<script src="https://cdn.jsdelivr.net/npm/litepicker/dist/litepicker.js"></script>
<script>
  document.addEventListener('DOMContentLoaded', function() {
    const picker = new Litepicker({
      element: document.getElementById('checkin'),
      elementEnd: document.getElementById('checkout'),
      singleMode: false,
      numberOfMonths: 2,
      numberOfColumns: 2,
      minDate: new Date(),
      format: 'YYYY-MM-DD',
      lang: 'de-DE',
      tooltipText: {
        one: 'Nacht',
        other: 'Nächte'
      },
      tooltipNumber: (totalDays) => {
        return totalDays - 1;
      },
      buttonText: {
        apply: 'Übernehmen',
        cancel: 'Abbrechen',
        previousMonth: '← Vorheriger Monat',
        nextMonth: 'Nächster Monat →',
        reset: 'Zurücksetzen'
      },
      dropdowns: {
        minYear: new Date().getFullYear(),
        maxYear: new Date().getFullYear() + 4,
        months: true,
        years: true
      },
      setup: (picker) => {
        picker.on('selected', (date1, date2) => {
          // Validierung: Abreise muss nach Anreise sein
          if (date1 && date2 && date1.getTime() === date2.getTime()) {
            alert('Abreise muss nach der Anreise sein!');
            picker.clearSelection();
          }
        });
      }
    });
  });

  function updateGuest(inputId, change) {
    const input = document.getElementById(inputId);
    let value = parseInt(input.value) + change;
    
    if (inputId === 'num_adults') {
        value = Math.max(1, Math.min(8, value));
    } else {
        value = Math.max(0, Math.min(6, value));
    }
    
    input.value = value;
    document.getElementById(inputId.replace('num_', '') + '-count').textContent = value;
}
</script>

{% endblock %}
